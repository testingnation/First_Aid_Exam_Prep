<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <title>First Aid Exam Prep</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; background: #f9f9f9; }
    .hidden { display: none; }
    .question { font-size: 1.2em; margin-bottom: 15px; }
    .choices label { display: block; margin: 8px 0; cursor: pointer; }
    button { padding: 10px 20px; margin-top: 15px; }
    #timer { font-weight: bold; margin-bottom: 20px; }
  </style>
</head>
<body>

  <!-- Welcome Screen -->
  <div id="welcome-screen">
    <h1>Добредојдовте во Првa Помош Тест</h1>
    <p>Кликнете подолу за да го започнете тестот.</p>
    <button onclick="startTest()">Започни го тестот</button>
  </div>

  <!-- Test Screen -->
  <div id="test-screen" class="hidden">
    <div id="timer"></div>
    <div id="question-container"></div>
    <button id="confirm-btn" onclick="confirmAnswer()">Потврди го одговорот</button>
  </div>

  <!-- Results Screen -->
  <div id="results-screen" class="hidden">
    <h2>Резултати</h2>
    <p id="score"></p>
    <button onclick="location.reload()">Започни повторно</button>
  </div>

<script>
let questions = [];
let currentQuestionIndex = 0;
let selectedAnswer = null;
let score = 0;
let timerInterval;

// Start Test
async function startTest() {
  document.getElementById("welcome-screen").classList.add("hidden");
  document.getElementById("test-screen").classList.remove("hidden");

  try {
    const response = await fetch("first_aid_questions.json");
    questions = await response.json();

    // Randomize and pick 15
    questions = questions.sort(() => 0.5 - Math.random()).slice(0, 15);

    startTimer(15 * 60); // 15 minutes
    showQuestion();
  } catch (error) {
    alert("Грешка при вчитување на прашањата.");
    console.error(error);
  }
}

// Show Question
function showQuestion() {
  const questionData = questions[currentQuestionIndex];
  if (!questionData) {
    return finishTest();
  }

  const container = document.getElementById("question-container");
  container.innerHTML = `
    <div class="question">${questionData.Question_Text}</div>
    <div class="choices">
      ${Object.keys(questionData)
        .filter(k => k.startsWith("Choice_"))
        .map((k, i) => `
          <label>
            <input type="radio" name="choice" value="${questionData[k]}">
            ${questionData[k]}
          </label>
        `).join("")}
    </div>
  `;
}

// Confirm Answer
function confirmAnswer() {
  const choices = document.querySelectorAll('input[name="choice"]:checked');
  if (choices.length === 0) {
    alert("Ве молиме изберете одговор.");
    return;
  }

  selectedAnswer = choices[0].value;

  if (selectedAnswer === questions[currentQuestionIndex].ANSWER) {
    score++;
  }

  currentQuestionIndex++;
  if (currentQuestionIndex < questions.length) {
    showQuestion();
  } else {
    finishTest();
  }
}

// Finish Test
function finishTest() {
  clearInterval(timerInterval);
  document.getElementById("test-screen").classList.add("hidden");
  document.getElementById("results-screen").classList.remove("hidden");
  document.getElementById("score").textContent = `Вашиот резултат е ${score} од ${questions.length}`;
}

// Timer
function startTimer(duration) {
  let time = duration;
  const timerDisplay = document.getElementById("timer");

  timerInterval = setInterval(() => {
    const minutes = Math.floor(time / 60);
    const seconds = time % 60;
    timerDisplay.textContent = `Време: ${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;

    if (--time < 0) {
      clearInterval(timerInterval);
      finishTest();
    }
  }, 1000);
}
</script>
</body>
</html>
