<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <title>Тест за Прва Помош</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; line-height: 1.6; }
    #welcome, #quizContainer, #results { max-width: 800px; margin: auto; }
    h1, h2, h3 { color: #0078D4; }
    button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 18px;
      background-color: #0078D4;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .question { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 6px; }
    .choices label { display: block; margin: 5px 0; }
    .correct { color: green; font-weight: bold; }
    .incorrect { color: red; font-weight: bold; }
    #timer { font-weight: bold; margin: 20px 0; }
  </style>
</head>
<body>

  <!-- Welcome Page -->
  <div id="welcome">
    <h1>Добредојдовте на тестот за Прва Помош</h1>
    <p>
      Овој сертификат е задолжителен за добивање возачка дозвола во Северна Македонија и Ви овозможува да бидете подготвени за итни ситуации на патот. 
      Тестот е базиран на официјалната банка на прашања на Црвениот Крст на Северна Македонија, осигурувајќи усогласеност со националните стандарди.
    </p>
    <p>
      Секое прашање е можност да учите, вежбате и да станете покомпетентни – останете фокусирани и верувајте во себе!
    </p>
    <h3>Инструкции за тестот:</h3>
    <ul>
      <li>Потребно е 80% за полагање (12 од 15 прашања).</li>
      <li>Времетраење: 60 минути од моментот кога ќе започнете.</li>
      <li>Прогрес-бар покажува колку прашања сте одговориле.</li>
      <li>Кога ќе завршите, кликнете <b>Submit</b> за да се пресмета тестот.</li>
      <li>Резултатот се прикажува веднаш како Pass/Fail со број на точни одговори (на пример, 14 од 15).</li>
    </ul>
    <p><strong>Совет:</strong> Одвојте внимание, останете смирени и верувајте во вашето знаење – секое прашање е шанса да научите и да се подготвите!</p>
    <button id="startBtn">Започни го тестот</button>
  </div>

  <!-- Quiz Section -->
  <div id="quizContainer" style="display:none;">
    <div id="timer">Преостанато време: 60:00</div>
    <form id="quizForm"></form>
    <button type="button" id="submitBtn">Поднеси одговори</button>
  </div>

  <!-- Results -->
  <div id="results"></div>

  <script>
    let questions = [];
    let timerInterval;

    document.getElementById("startBtn").onclick = () => {
      document.getElementById("welcome").style.display = "none";
      document.getElementById("quizContainer").style.display = "block";
      loadQuiz();
    };

    async function loadQuiz() {
      const res = await fetch("first_aid_questions.json");
      questions = await res.json();

      // Pick first 15 for now (or randomize if needed)
      questions = shuffle(questions).slice(0, 15);

      renderQuestions();
      startTimer(60 * 60);
    }

    function renderQuestions() {
      const quizForm = document.getElementById("quizForm");
      quizForm.innerHTML = questions.map((q, i) => `
        <div class="question">
          <p><b>Прашање ${i + 1}:</b> ${q.question}</p>
          <div class="choices">
            ${q.choices.map(c => `
              <label>
                <input type="radio" name="q${i}" value="${c}"> ${c}
              </label>
            `).join("")}
          </div>
        </div>
      `).join("");
    }

    function startTimer(seconds) {
      const timerDiv = document.getElementById("timer");
      let remaining = seconds;
      timerInterval = setInterval(() => {
        const mins = Math.floor(remaining / 60);
        const secs = remaining % 60;
        timerDiv.textContent = `Преостанато време: ${mins}:${secs < 10 ? "0" : ""}${secs}`;
        if (--remaining < 0) {
          clearInterval(timerInterval);
          gradeQuiz();
        }
      }, 1000);
    }

    function gradeQuiz() {
      clearInterval(timerInterval);
      const formData = new FormData(document.getElementById("quizForm"));
      let score = 0;

      questions.forEach((q, i) => {
        const userAnswer = formData.get("q" + i);
        if (userAnswer === q.answer) {
          score++;
        }
      });

      const passingScore = 12;
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = `
        <h2>Резултати</h2>
        <p><strong>Вашиот резултат: ${score} / ${questions.length}</strong></p>
        ${score >= passingScore
          ? `<p class="correct">✅ Честитки! Положивте.</p>`
          : `<p class="incorrect">❌ Не положивте. Прегледајте го материјалот и обидете се повторно.</p>`}
      `;
      document.getElementById("quizContainer").style.display = "none";
    }

    document.getElementById("submitBtn").onclick = gradeQuiz;

    // Shuffle helper
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i-
