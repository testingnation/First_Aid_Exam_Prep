<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <title>First Aid Exam Prep</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; background: #f9f9f9; }
    .hidden { display: none; }
    
    .question { font-size: 1.2em; margin-bottom: 15px; color: navy; text-align: left; }
    .choices label { display: block; margin: 8px 0; cursor: pointer; color: black; }
    button { padding: 10px 18px; margin-right: 10px; font-size: 14px; font-weight: bold; cursor: pointer; }

    /* Test Screen Layout */
    #test-screen, #welcome-screen, #results-screen, #review-screen {
      max-width: 700px; margin: 50px auto; padding: 30px; border: 2px solid #333; border-radius: 10px; background: #f1f1f1; position: relative;
    }
    #timer { font-weight: bold; position: absolute; top: 20px; right: 20px; color: #555; }

    /* Progress Tracker */
    #progress-container {
      display: grid;
      grid-template-columns: repeat(15, 1fr);
      gap: 5px;
      margin: 40px 0 20px 0;
    }
    .progress-box {
      border: 1px solid #333;
      padding: 8px;
      text-align: center;
      font-weight: bold;
      background: white;
      color: black;
      border-radius: 5px;
    }
    .progress-box.answered {
      background: #2e7d32; /* dark green */
      color: white;
    }

    /* Footer */
    .footer {
      font-size: 0.8em;
      color: #333;
      text-align: center;
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #999;
    }

    @media print {
      button { display: none; }
      body { background: #fff; }
    }
  </style>
</head>
<body>

<!-- Welcome Screen -->
<div id="welcome-screen">
  <h1 style="text-align: center; margin-bottom: 20px;">–î–æ–±—Ä–µ–¥–æ—ò–¥–æ–≤—Ç–µ –≤–æ –ü—Ä–≤a –ü–æ–º–æ—à –¢–µ—Å—Ç</h1>
  <p style="color: red; font-weight: bold; text-align: center; margin-bottom: 20px;">
    –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ –∫–æ—Ä–∏—Å—Ç–µ—Ç–µ –≥–æ –∫–æ–ø—á–µ—Ç–æ ‚Äû–ù–∞–∑–∞–¥‚Äú –Ω–∞ –≤–∞—à–∏–æ—Ç –ø—Ä–µ–ª–∏—Å—Ç—É–≤–∞—á –∑–∞ –≤—Ä–µ–º–µ –Ω–∞ —Ç–µ—Å—Ç–æ—Ç!
  </p>
  <p>–û–≤–æ—ò —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –µ –∑–∞–¥–æ–ª–∂–∏—Ç–µ–ª–µ–Ω –∑–∞ –¥–æ–±–∏–≤–∞—ö–µ –≤–æ–∑–∞—á–∫–∞ –¥–æ–∑–≤–æ–ª–∞ –≤–æ –°–µ–≤–µ—Ä–Ω–∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞ –∏ –í–∏ –æ–≤–æ–∑–º–æ–∂—É–≤–∞ –¥–∞ –±–∏–¥–µ—Ç–µ –ø–æ–¥–≥–æ—Ç–≤–µ–Ω–∏ –∑–∞ –∏—Ç–Ω–∏ —Å–∏—Ç—É–∞—Ü–∏–∏ –Ω–∞ –ø–∞—Ç–æ—Ç. –¢–µ—Å—Ç–æ—Ç –µ –±–∞–∑–∏—Ä–∞–Ω –Ω–∞ –æ—Ñ–∏—Ü–∏—ò–∞–ª–Ω–∞—Ç–∞ –±–∞–Ω–∫–∞ –Ω–∞ –ø—Ä–∞—à–∞—ö–∞ –Ω–∞ –¶—Ä–≤–µ–Ω–∏–æ—Ç –ö—Ä—Å—Ç –Ω–∞ –°–µ–≤–µ—Ä–Ω–∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞, –æ—Å–∏–≥—É—Ä—É–≤–∞—ò—ú–∏ —É—Å–æ–≥–ª–∞—Å–µ–Ω–æ—Å—Ç —Å–æ –Ω–∞—Ü–∏–æ–Ω–∞–ª–Ω–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä–¥–∏.</p>
  <p>–°–µ–∫–æ–µ –ø—Ä–∞—à–∞—ö–µ –µ –º–æ–∂–Ω–æ—Å—Ç –¥–∞ —É—á–∏—Ç–µ, –≤–µ–∂–±–∞—Ç–µ –∏ –¥–∞ —Å—Ç–∞–Ω–µ—Ç–µ –ø–æ–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–∏ ‚Äì –æ—Å—Ç–∞–Ω–µ—Ç–µ —Ñ–æ–∫—É—Å–∏—Ä–∞–Ω–∏ –∏ –≤–µ—Ä—É–≤–∞—ò—Ç–µ –≤–æ —Å–µ–±–µ!</p>
  <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ —Ç–µ—Å—Ç–æ—Ç:</h3>
  <ol style="margin-left: 20px;">
    <li>–û—Ç–∫–∞–∫–æ —ú–µ –∫–ª–∏–∫–Ω–µ—Ç–µ <strong>–ó–∞–ø–æ—á–Ω–∏ –≥–æ —Ç–µ—Å—Ç–æ—Ç</strong>, —ú–µ –∏–º–∞—Ç–µ 60 –º–∏–Ω—É—Ç–∏ –∑–∞ –¥–∞ –æ–¥–≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞ —Å–∏—Ç–µ 15 –ø—Ä–∞—à–∞—ö–∞.</li>
    <li>–õ–µ–Ω—Ç–∞—Ç–∞ –∑–∞ –Ω–∞–ø—Ä–µ–¥–æ–∫ (Progress Bar) –ø–æ–∫–∞–∂—É–≤–∞ –∫–æ–ª–∫—É –ø—Ä–∞—à–∞—ö–∞ —Å—Ç–µ –æ–¥–≥–æ–≤–æ—Ä–∏–ª–µ.</li>
    <li>–û—Ç–∫–∞–∫–æ —ú–µ –∏–∑–±–µ—Ä–µ—Ç–µ –æ–¥–≥–æ–≤–æ—Ä, –∫–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ <strong>‚úÖ –ü–æ—Ç–≤—Ä–¥–∏ –≥–æ –æ–¥–≥–æ–≤–æ—Ä–æ—Ç</strong>. –ê–∫–æ –Ω–µ —Å—Ç–µ —Å–∏–≥—É—Ä–Ω–∏, –º–æ–∂–µ—Ç–µ –¥–∞ –∫–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ <strong>‚û°Ô∏è –ü—Ä–µ—Å–∫–æ–∫–Ω–∏ –∑–∞ —Å–µ–≥–∞</strong> ‚Äì —Ç–µ—Å—Ç–æ—Ç —ú–µ –≤–µ –≤—Ä–∞—Ç–∏ –Ω–∞ –ø—Ä–µ—Å–∫–æ–∫–Ω–∞—Ç–∏—Ç–µ –ø—Ä–∞—à–∞—ö–∞ –ø–æ–¥–æ—Ü–Ω–∞.</li>
    <li>–ü–æ—Ç—Ä–µ–±–Ω–æ –µ –¥–∞ –æ–¥–≥–æ–≤–æ—Ä–∏—Ç–µ —Ç–æ—á–Ω–æ –Ω–∞ –Ω–∞—ò–º–∞–ª–∫—É 12 –æ–¥ 15 –ø—Ä–∞—à–∞—ö–∞ (80%) –∑–∞ –¥–∞ –ø–æ–ª–æ–∂–∏—Ç–µ.</li>
    <li>–ö–æ–≥–∞ —ú–µ –∑–∞–≤—Ä—à–∏—Ç–µ, —Ä–µ–∑—É–ª—Ç–∞—Ç–æ—Ç —ú–µ —Å–µ –ø—Ä–µ—Å–º–µ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç—Å–∫–∏ –∏ —ú–µ —Å–µ –ø—Ä–∏–∫–∞–∂–µ –∫–∞–∫–æ –ü–æ–ª–æ–∂–∏–≤—Ç–µ / –ù–µ –ø–æ–ª–æ–∂–∏–≤—Ç–µ.</li>
  </ol>
  <p style="text-align: center; margin-top: 30px; font-weight: bold;">
    –û–¥–≤–æ—ò—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, –æ—Å—Ç–∞–Ω–µ—Ç–µ —Å–º–∏—Ä–µ–Ω–∏ –∏ –≤–µ—Ä—É–≤–∞—ò—Ç–µ –≤–æ –≤–∞—à–µ—Ç–æ –∑–Ω–∞–µ—ö–µ ‚Äì —Å–µ–∫–æ–µ –ø—Ä–∞—à–∞—ö–µ –µ —à–∞–Ω—Å–∞ –¥–∞ –Ω–∞—É—á–∏—Ç–µ –∏ –¥–∞ —Å–µ –ø–æ–¥–≥–æ—Ç–≤–∏—Ç–µ!
  </p>
  <div style="text-align: center; margin-top: 20px;">
    <button onclick="startTest()">–ó–∞–ø–æ—á–Ω–∏ –≥–æ —Ç–µ—Å—Ç–æ—Ç</button>
  </div>
  <div class="footer">‚ù§Ô∏è‚Äçü©π –¢–µ—Å—Ç –ø–æ –ü—Ä–≤–∞ –ü–æ–º–æ—à | –ò–∑–¥–∞–Ω–∏–µ 2025 | –í–µ—Ä–∑–∏–∞ 01–ê | –°–∫–æ–ø—ò–µ | –†. –°. –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞ | –ó–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏ —Ü–µ–ª–∏</div>
</div>

<!-- Test Screen -->
<div id="test-screen" class="hidden">
  <div id="timer"></div>
  <div id="progress-container"></div>
  <div id="question-container"></div>
  <div style="margin-top: 30px; text-align: left;">
    <button onclick="confirmAnswer()">‚úÖ –ü–æ—Ç–≤—Ä–¥–∏ –≥–æ –æ–¥–≥–æ–≤–æ—Ä–æ—Ç</button>
    <button onclick="skipQuestion()">‚û°Ô∏è –ü—Ä–µ—Å–∫–æ–∫–Ω–∏ –∑–∞ —Å–µ–≥–∞</button>
    <button onclick="exitTest()">üü• –ü—Ä–µ–∫–∏–Ω–µ—Ç–µ –≥–æ —Ç–µ—Å—Ç–æ—Ç</button>
  </div>
  <div class="footer">‚ù§Ô∏è‚Äçü©π –¢–µ—Å—Ç –ø–æ –ü—Ä–≤–∞ –ü–æ–º–æ—à | –ò–∑–¥–∞–Ω–∏–µ 2025 | –í–µ—Ä–∑–∏–∞ 01–ê | –°–∫–æ–ø—ò–µ | –†. –°. –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞ | –ó–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏ —Ü–µ–ª–∏</div>
</div>

<!-- Results Screen -->
<div id="results-screen" class="hidden">
  <h2>–†–µ–∑—É–ª—Ç–∞—Ç–∏</h2>
  <p id="score"></p>
  <div class="footer">‚ù§Ô∏è‚Äçü©π –¢–µ—Å—Ç –ø–æ –ü—Ä–≤–∞ –ü–æ–º–æ—à | –ò–∑–¥–∞–Ω–∏–µ 2025 | –í–µ—Ä–∑–∏–∞ 01–ê | –°–∫–æ–ø—ò–µ | –†. –°. –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞ | –ó–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏ —Ü–µ–ª–∏</div>
</div>

<!-- Review Screen -->
<div id="review-screen" class="hidden">
  <h2>–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –Ω–µ—Ç–æ—á–Ω–∏ –æ–¥–≥–æ–≤–æ—Ä–∏</h2>
  <div id="review-content"></div>
  <button onclick="window.print()">üñ®Ô∏è –ü–µ—á–∞—Ç–∏ –ø—Ä–µ–≥–ª–µ–¥</button>
  <button onclick="location.reload()">–ó–∞–ø–æ—á–Ω–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
  <div class="footer">‚ù§Ô∏è‚Äçü©π –¢–µ—Å—Ç –ø–æ –ü—Ä–≤–∞ –ü–æ–º–æ—à | –ò–∑–¥–∞–Ω–∏–µ 2025 | –í–µ—Ä–∑–∏–∞ 01–ê | –°–∫–æ–ø—ò–µ | –†. –°. –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞ | –ó–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏ —Ü–µ–ª–∏</div>
</div>

<script>
let questions = [];
let selectedQuestions = [];
let currentQuestionIndex = 0;
let score = 0;
let userAnswers = [];
let unansweredIndices = [];
let timerInterval;

const groupRatios = {
  "FAB": 2, "S&A": 1, "A&P": 1, "AB&": 2,
  "B&S": 4, "C&R": 2, "I&S": 1, "C&A": 0,
  "WC&": 1, "SC&": 1
};

async function startTest() {
  document.getElementById("welcome-screen").classList.add("hidden");
  document.getElementById("test-screen").classList.remove("hidden");

  try {
    const response = await fetch("first_aid_questions.json");
    questions = await response.json();

    const grouped = {};
    for (let q of questions) {
      const group = q.group || "OTHER";
      if (!grouped[group]) grouped[group] = [];
      grouped[group].push(q);
    }

    for (let [group, count] of Object.entries(groupRatios)) {
      if (grouped[group]) {
        const shuffled = grouped[group].sort(() => 0.5 - Math.random());
        selectedQuestions.push(...shuffled.slice(0, count));
      }
    }

    selectedQuestions = selectedQuestions.sort(() => 0.5 - Math.random());

    const progressContainer = document.getElementById("progress-container");
    progressContainer.innerHTML = "";
    for (let i = 0; i < selectedQuestions.length; i++) {
      const box = document.createElement("div");
      box.classList.add("progress-box");
      box.textContent = i + 1;
      progressContainer.appendChild(box);
    }

    unansweredIndices = selectedQuestions.map((_, i) => i);
    userAnswers = new Array(selectedQuestions.length);

    startTimer(60 * 60);
    showQuestion(unansweredIndices[0]);
  } catch (error) {
    alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ –ø—Ä–∞—à–∞—ö–∞—Ç–∞.");
    console.error(error);
  }
}

function showQuestion(index) {
  currentQuestionIndex = index;
  const q = selectedQuestions[index];
  const container = document.getElementById("question-container");
  const shuffledChoices = [...q.choices].sort(() => 0.5 - Math.random());

  container.innerHTML = `
    <div class="question">${q.question}</div>
    <div class="choices">
      ${shuffledChoices.map(choice => `
        <label>
          <input type="radio" name="choice" value="${choice}" ${userAnswers[index] === choice ? "checked" : ""}> ${choice}
        </label>
      `).join("")}
    </div>
  `;
}

function confirmAnswer() {
  const selected = document.querySelector('input[name="choice"]:checked');
  if (!selected) {
    alert("–í–µ –º–æ–ª–∏–º–µ –∏–∑–±–µ—Ä–µ—Ç–µ –æ–¥–≥–æ–≤–æ—Ä.");
    return;
  }

  userAnswers[currentQuestionIndex] = selected.value;
  if (selected.value === selectedQuestions[currentQuestionIndex].answer) score++;

  document.querySelectorAll(".progress-box")[currentQuestionIndex].classList.add("answered");
  unansweredIndices = unansweredIndices.filter(i => i !== currentQuestionIndex);

  goToNextQuestion();
}

function skipQuestion() { goToNextQuestion(true); }

function exitTest() {
  if (confirm("–î–∞–ª–∏ –Ω–∞–≤–∏—Å—Ç–∏–Ω–∞ —Å–∞–∫–∞—Ç–µ –¥–∞ –≥–æ –ø—Ä–µ–∫–∏–Ω–µ—Ç–µ —Ç–µ—Å—Ç–æ—Ç?")) {
    document.getElementById("test-screen").classList.add("hidden");
    document.getElementById("welcome-screen").classList.remove("hidden");
    // reset state
    selectedQuestions = [];
    currentQuestionIndex = 0;
    score = 0;
    userAnswers = [];
    unansweredIndices = [];
    clearInterval(timerInterval);
  }
}

function goToNextQuestion(skipped = false) {
  if (unansweredIndices.length === 0) { finishTest(); return; }
  let nextIndex;
  if (skipped) {
    const currentPos = unansweredIndices.indexOf(currentQuestionIndex);
    nextIndex = (currentPos === -1 || currentPos === unansweredIndices.length - 1) ? unansweredIndices[0] : unansweredIndices[currentPos + 1];
  } else { nextIndex = unansweredIndices[0]; }
  showQuestion(nextIndex);
}

function finishTest() {
  clearInterval(timerInterval);
  document.getElementById("test-screen").classList.add("hidden");
  document.getElementById("results-screen").classList.remove("hidden");

  const passScore = Math.ceil(selectedQuestions.length * 0.8);
  const resultText = score >= passScore
    ? `‚úÖ –ß–µ—Å—Ç–∏—Ç–∫–∏! –ü–æ–ª–æ–∂–∏–≤—Ç–µ —Å–æ ${score} –æ–¥ ${selectedQuestions.length} —Ç–æ—á–Ω–∏ –æ–¥–≥–æ–≤–æ—Ä–∏.`
    : `‚ùå –ù–µ –ø–æ–ª–æ–∂–∏–≤—Ç–µ. –í–∞—à–∏–æ—Ç —Ä–µ–∑—É–ª—Ç–∞—Ç –µ ${score} –æ–¥ ${selectedQuestions.length}. –û–±–∏–¥–µ—Ç–µ —Å–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ.`;

  document.getElementById("score").innerHTML = resultText;

  const reviewDiv = document.getElementById("review-content");
  const incorrectOnly = selectedQuestions.map((q, i) => ({
    index: i + 1, question: q.question, correct: q.answer, user: userAnswers[i], isCorrect: userAnswers[i] === q.answer
  })).filter(q => !q.isCorrect);

  if (incorrectOnly.length > 0) {
    document.getElementById("review-screen").classList.remove("hidden");
    reviewDiv.innerHTML = incorrectOnly.map(q => `
      <div class="incorrect">
        <p><b>–ü—Ä–∞—à–∞—ö–µ ${q.index}:</b> ${q.question}</p>
        <p>–í–∞—à –æ–¥–≥–æ–≤–æ—Ä: <span style="color:red;">${q.user || "–ù–µ–æ–¥–≥–æ–≤–æ—Ä–µ–Ω–æ"}</span></p>
        <p>–¢–æ—á–µ–Ω –æ–¥–≥–æ–≤–æ—Ä: <span style="color:green;"><b>${q.correct}</b></span></p>
        <hr>
      </div>
    `).join("");
  }
}

function startTimer(duration) {
  let time = duration;
  const timerDisplay = document.getElementById("timer");

  timerInterval = setInterval(() => {
    const minutes = Math.floor(time / 60);
    const seconds = time % 60;
    timerDisplay.textContent = `–ü—Ä–µ–æ—Å—Ç–∞–Ω–∞—Ç–æ –≤—Ä–µ–º–µ: ${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
    if (--time < 0) {
      clearInterval(timerInterval);
      finishTest();
    }
  }, 1000);
}
</script>

</body>
</html>
