<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <title>First Aid Exam Prep</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    #welcome, #quiz, #results { display: none; }
    .question { margin-bottom: 20px; font-weight: bold; }
    .choices label { display: block; margin: 5px 0; }
    .hidden { display: none; }
    #progressBar { margin-top: 15px; }
  </style>
</head>
<body>

  <!-- Welcome screen -->
  <div id="welcome">
    <h2>Добредојдовте во тестот за прва помош</h2>
    <p>За да го положите тестот, потребни се најмалку 80% (12 точни од 15).</p>
    <p>Времетраење: 60 минути.</p>
    <p>Ќе имате прашања од различни категории.</p>
    <button id="startBtn">Започни го тестот</button>
  </div>

  <!-- Quiz screen -->
  <div id="quiz">
    <div id="timer"></div>
    <div id="progress"></div>
    <div id="progressBar"></div>
    <div class="question" id="question"></div>
    <div class="choices" id="choices"></div>
    <button id="submitBtn">Потврди одговор</button>
  </div>

  <!-- Results screen -->
  <div id="results">
    <h2>Резултати</h2>
    <p id="scoreText"></p>
    <button onclick="location.reload()">Започни повторно</button>
  </div>

  <script>
    let allQuestions = [];
    let selectedQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let timerInterval;

    // Group distribution
    const groupDistribution = {
      "FAB": 2,
      "S&A": 1,
      "A&P": 1,
      "AB&": 2,
      "B&S": 4,
      "C&R": 2,
      "I&S": 1,
      "WC&": 1,
      "SC&": 1
    };

    // Load questions from JSON
    async function loadQuestions() {
      const res = await fetch("first_aid_questions.json");
      allQuestions = await res.json();
      document.getElementById("welcome").style.display = "block";
    }

    // Pick questions based on distribution
    function pickQuestions() {
      selectedQuestions = [];
      for (const group in groupDistribution) {
        let groupQs = allQuestions.filter(q => q.GROUP_CODE === group);
        shuffle(groupQs);
        selectedQuestions.push(...groupQs.slice(0, groupDistribution[group]));
      }
      shuffle(selectedQuestions);
    }

    // Shuffle array helper
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Start quiz
    function startQuiz() {
      document.getElementById("welcome").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      pickQuestions();
      startTimer(60 * 60);
      showQuestion();
    }

    // Show a question
    function showQuestion() {
      let q = selectedQuestions[currentIndex];
      document.getElementById("question").textContent = q.Question_Text;
      let choicesDiv = document.getElementById("choices");
      choicesDiv.innerHTML = "";
      for (let i = 1; i <= 5; i++) {
        if (q["Choice_" + i]) {
          let choiceHTML = `
            <label>
              <input type="radio" name="choice" value="${i}"> ${q["Choice_" + i]}
            </label>
          `;
          choicesDiv.innerHTML += choiceHTML;
        }
      }
      document.getElementById("progress").textContent =
        "Одговорени прашања: " + currentIndex + " / " + selectedQuestions.length;
    }

    // Confirm answer
    function submitAnswer() {
      let selected = document.querySelector("input[name='choice']:checked");
      if (!selected) return alert("Изберете одговор!");
      let answer = selected.value;
      if (answer == selectedQuestions[currentIndex].ANSWER) {
        score++;
      }
      currentIndex++;
      if (currentIndex < selectedQuestions.length) {
        showQuestion();
      } else {
        endQuiz();
      }
    }

    // End quiz
    function endQuiz() {
      clearInterval(timerInterval);
      document.getElementById("quiz").style.display = "none";
      document.getElementById("results").style.display = "block";
      let pass = score >= 12 ? "ПОЛОЖЕНО ✅" : "НЕ ПОЛОЖЕНО ❌";
      document.getElementById("scoreText").textContent =
        pass + " — " + score + " точни од " + selectedQuestions.length;
    }

    // Timer
    function startTimer(duration) {
      let remaining = duration;
      timerInterval = setInterval(() => {
        let minutes = Math.floor(remaining / 60);
        let seconds = remaining % 60;
        document.getElementById("timer").textContent =
          "Преостанато време: " + minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
        if (--remaining < 0) {
          clearInterval(timerInterval);
          endQuiz();
        }
      }, 1000);
    }

    document.getElementById("startBtn").addEventListener("click", startQuiz);
    document.getElementById("submitBtn").addEventListener("click", submitAnswer);

    loadQuestions();
  </script>

</body>
</html>
