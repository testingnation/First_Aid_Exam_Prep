<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <title>First Aid Exam Prep</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; line-height: 1.6; }
    #welcome, #quizContainer, #results, #review { max-width: 800px; margin: auto; }
    #startBtn, #confirm, #next, #submitFinal {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #0078D4;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .question { margin-bottom: 20px; }
    .choices label { display: block; margin: 5px 0; }
    .locked { color: gray; }
    .correct { color: green; }
    .incorrect { color: red; }
    #timer, #progress { font-weight: bold; margin: 20px 0; }
  </style>
</head>
<body>

  <!-- Welcome Page -->
  <div id="welcome">
    <h1>Добредојдовте на тестот за Прва Помош</h1>
    <p>Овој сертификат е задолжителен за добивање возачка дозвола во Северна Македонија и Ви овозможува да бидете подготвени за итни ситуации на патот. Тестот е базиран на официјалната банка на прашања на Црвениот Крст на Северна Македонија, осигурувајќи усогласеност со националните стандарди.</p>
    <p>Секое прашање е можност да учите, вежбате и да станете покомпетентни – останете фокусирани и верувајте во себе!</p>
    <h3>Инструкции за тестот:</h3>
    <ul>
      <li>Потребно е 80% за полагање (12 од 15 прашања).</li>
      <li>Времетраење: 60 минути од моментот кога ќе започнете.</li>
      <li>Прогрес-бар покажува колку прашања сте одговориле.</li>
      <li>Кога ќе завршите, кликнете Submit за да се пресмета тестот.</li>
      <li>Резултатот се прикажува веднаш како Pass/Fail со број на точни одговори (на пример, 14 од 15).</li>
    </ul>
    <p><strong>Совет:</strong> Одвојте внимание, останете смирени и верувајте во вашето знаење – секое прашање е шанса да научите и да се подготвите!</p>
    <button id="startBtn">Започни го тестот</button>
  </div>

  <!-- Quiz Section -->
  <div id="quizContainer" style="display:none;">
    <div id="timer">Time Remaining: 60:00</div>
    <div id="progress">Одговорени прашања: 0 / 0</div>
    <div id="quiz"></div>
    <div id="navigation">
      <button id="confirm">Потврди одговор</button>
      <button id="next" style="display:none;">Следно прашање</button>
    </div>
  </div>

  <!-- Results and Review -->
  <div id="results"></div>
  <div id="review"></div>

  <script>
    let questions = [];
    let currentIndex = 0;
    let answers = {};
    let locked = {};
    let timer;

    document.getElementById("startBtn").onclick = () => {
      document.getElementById("welcome").style.display = "none";
      document.getElementById("quizContainer").style.display = "block";
      loadQuiz();
    };

    async function loadQuiz() {
      const res = await fetch("first_aid_questions.json");
      questions = await res.json();
      questions = shuffle(questions);
      document.getElementById("progress").textContent = `Одговорени прашања: 0 / ${questions.length}`;
      startTimer(60 * 60);
      renderQuestion(currentIndex);
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function renderQuestion(index) {
      const q = questions[index];
      const quizDiv = document.getElementById("quiz");
      const shuffledChoices = shuffle([...q.choices]);

      quizDiv.innerHTML = `
        <div class="question">
          <p><b>Прашање ${index + 1}:</b> ${q.question}</p>
          <div class="choices">
            ${shuffledChoices.map(c => `
              <label class="${locked[index] ? 'locked' : ''}">
                <input type="radio" name="q${index}" value="${c}" ${locked[index] ? 'disabled' : ''}> ${c}
              </label>
            `).join("")}
          </div>
        </div>
      `;

      document.getElementById("confirm").style.display = locked[index] ? "none" : "inline";
      document.getElementById("next").style.display = locked[index] ? "inline" : "none";
    }

    document.getElementById("confirm").onclick = () => {
      const selected = document.querySelector(`input[name="q${currentIndex}"]:checked`);
      if (!selected) return alert("Изберете одговор пред да потврдите.");
      answers[currentIndex] = selected.value;
      locked[currentIndex] = true;
      updateProgress();
      renderQuestion(currentIndex);
    };

    document.getElementById("next").onclick = () => {
      const nextUnanswered = questions.findIndex((_, i) => !locked[i]);
      if (nextUnanswered !== -1) {
        currentIndex = nextUnanswered;
        renderQuestion(currentIndex);
      } else {
        confirmSubmission();
      }
    };

    function updateProgress() {
      const count = Object.keys(answers).length;
      document.getElementById("progress").textContent = `Одговорени прашања: ${count} / ${questions.length}`;
    }

    function confirmSubmission() {
      if (Object.keys(answers).length < questions.length) {
        alert("Имате неодговорени прашања. Ќе се вратите на првото неодговорено.");
        currentIndex = questions.findIndex((_, i) => !locked[i]);
        renderQuestion(currentIndex);
        return;
      }

      const score = questions.reduce((acc, q, i) => {
        return answers[i] === q.answer ? acc + 1 : acc;
      }, 0);

      const passingScore = Math.ceil(questions.length * 0.8);
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = `
        <p><strong>Вашиот резултат: ${score} / ${questions.length}</strong></p>
        ${score >= passingScore
          ? `<p class="correct">✅ Честитки! Положивте.</p>`
          : `<p class="incorrect">❌ Не положивте. Прегледајте ги прашањата и обидете се повторно.</p>`}
        <button id="submitFinal">Прегледај ги прашањата</button>
      `;

      document.getElementById("quizContainer").style.display = "none";
      document.getElementById("submitFinal").onclick = showReview;
    }

    function showReview() {
      const reviewDiv = document.getElementById("review");
      reviewDiv.innerHTML = questions.map((q, i) => {
        const userAnswer = answers[i];
        const isCorrect = userAnswer === q.answer;
        return `
          <div class="${isCorrect ? 'correct' : 'incorrect'}">
            <p><b>Прашање ${i + 1}:</b> ${q.question}</p>
            <p>Ваш одговор: ${userAnswer || "Неодговорено"}</p>
            ${!isCorrect ? `<p>Точен одговор: <b>${q.answer}</b></p>` : ""}
          </div>
        `;
      }).join("");
    }

    function startTimer(seconds) {
      const timerDiv = document.getElementById("timer");
      let remaining = seconds;
      timer = setInterval(() => {
        const mins = Math.floor(remaining / 60);
        const secs = remaining % 60;
        timerDiv.textContent = `Преостанато време: ${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
       
